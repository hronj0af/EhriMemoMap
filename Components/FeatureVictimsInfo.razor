@using System.Linq
@using System.Text.RegularExpressions;


@inject IStringLocalizer<CommonResources> cl
@inject MapState MapState

@if (WMSResponse != null && WMSResponse.Layers != null && WMSResponse.Layers.Any(a => (a.Type == WMSFeatureType.Obeti_holokaustu_z_Prahy || a.Type == WMSFeatureType.Bydliste_Zidu_v_Praze_v_dobe_okupace) && a.Features != null && a.Features.Count > 0))
{
    @foreach (var victimGroup in WMSResponse.Layers.Where(a => a.Type == WMSFeatureType.Obeti_holokaustu_z_Prahy || a.Type == WMSFeatureType.Bydliste_Zidu_v_Praze_v_dobe_okupace).SelectMany(a => a.Features).GroupBy(b => b.Address))
    {
        <h3>@victimGroup.Key</h3>
        <RadzenRow Gap="1rem" JustifyContent=JustifyContent.Left>
            @foreach (var house in victimGroup.Where(a => a.FeatureInfoType == WMSFeatureType.Bydliste_Zidu_v_Praze_v_dobe_okupace))
            {
                <HouseCard House="@house"/>
            }

            @if (victimGroup.Any(a => a.FeatureInfoType == WMSFeatureType.Obeti_holokaustu_z_Prahy && a.Status == StatusEnum.present))
            {
                <RadzenColumn Size="12">
                <h4>@cl["present"]</h4>
                </RadzenColumn>
                foreach (var victim in victimGroup.Where(a => a.FeatureInfoType == WMSFeatureType.Obeti_holokaustu_z_Prahy && a.Status == StatusEnum.present))
                {
                    <VictimCard Victim="@victim" />
                }

            }

            @if (victimGroup.Any(a => a.FeatureInfoType == WMSFeatureType.Obeti_holokaustu_z_Prahy && a.Status == StatusEnum.absent))
            {
                <RadzenColumn Size="12">
                    <h4>@cl["deported"]</h4>
                </RadzenColumn>
                foreach (var victim in victimGroup.Where(a => a.FeatureInfoType == WMSFeatureType.Obeti_holokaustu_z_Prahy && a.Status == StatusEnum.absent))
                {
                    <VictimCard Victim="@victim" />
                }

            }

            @if (!victimGroup.Any(a => a.FeatureInfoType == WMSFeatureType.Obeti_holokaustu_z_Prahy && (a.Status == StatusEnum.present || a.Status == StatusEnum.absent)))
            {
                foreach (var victim in victimGroup.Where(a => a.FeatureInfoType == WMSFeatureType.Obeti_holokaustu_z_Prahy))
                {
                    <VictimCard Victim="@victim" />
                }
            }

        </RadzenRow>
    }
}

@code {
    [Parameter]
    public WMSResponse WMSResponse { get; set; }

}
