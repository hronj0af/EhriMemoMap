@inject DialogService DialogService
@inject IJSRuntime JS
@inject MapService MapService

@{
    var buttonStyle = "z-index:2000;position:fixed;background-color:var(--Beige-LIGHT);width:" + (MapService.IsMobileView ? "100%" : MapService.WidthOfDialogPercent);
}

<RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="@buttonStyle">
    <RadzenStack Orientation="Orientation.Horizontal">
        @if (MapService.DialogParametersHistory.Count > 1)
        {
            <RadzenButton Click=OnBack Icon="arrow_back" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" />
        }
    </RadzenStack>
    <RadzenStack Orientation="Orientation.Horizontal">
        @if (MapService.IsMobileView && MapService.DialogType != DialogTypeEnum.Help)
        {
            <RadzenButton Click=OnFullscreen Icon="fullscreen" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" />
        }
        <RadzenButton Click=OnClose Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" />
    </RadzenStack>
</RadzenRow>

@code {

    private async Task OnClose()
    {
        if (MapService.DialogType == DialogTypeEnum.StoryMap)
            await MapService.SetMapType(MapTypeEnum.Normal);
        MapService.IsDialogFullScreen = false;
        await MapService.SetDialog(DialogTypeEnum.None);
        MapService.NotifyStateChanged();
    }

    private async Task OnFullscreen()
    {
        MapService.IsDialogFullScreen = !MapService.IsDialogFullScreen;
        await JS.InvokeVoidAsync("mapAPI.setDialogFullScreen", MapService.IsDialogFullScreen);
        MapService.NotifyStateChanged();
    }

    private async Task OnBack()
    {
        await MapService.SetLastDialog();
        MapService.NotifyStateChanged();
    }

    protected override void OnInitialized()
    {
        MapService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        MapService.OnChange -= StateHasChanged;
    }
}