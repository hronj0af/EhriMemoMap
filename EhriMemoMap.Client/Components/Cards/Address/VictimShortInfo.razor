@inject IStringLocalizer<CommonResources> cl
@inject MapStateService MapState

@if (Victim != null)
{
    <RadzenColumn Size="Small ? (MapState.IsMobileView ? 4 : 3) : (MapState.IsMobileView ? 6 : 4)">
        @if (!Victim.LongInfo)
        {
            <a href="@(CultureInfo.CurrentCulture.ToString() == "cs-CZ" ? Victim.DetailsCs : Victim.DetailsEn)" target="_blank" style="text-decoration:none;color:black">
                <RadzenCard class="@(VictimCardCss)">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Gap="5px">
                        <RadzenImage class="victim-photo" Path="@(!string.IsNullOrEmpty(Victim.Photo) && Victim.Photo != "NULL" && Victim.Photo != "null" ? Victim.Photo : "images/face.png")" />
                        <div class="victim-label"><small>@((MarkupString)Victim.GetLabelForPicture())</small></div>
                    </RadzenStack>
                </RadzenCard>
            </a>
        }
        else
        {
            <RadzenCard class="@(VictimCardCss)" @onclick="OnVictimClick" Style="cursor:pointer">
                <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Gap="5px">
                    <RadzenImage title="@Victim.GetBirthdateTitle()" class="victim-photo" Path="@(!string.IsNullOrEmpty(Victim.Photo) && Victim.Photo != "NULL" && Victim.Photo != "null" ? Victim.Photo : "images/face.png")" />
                    <div class="victim-label">
                        <div>
                            <small>
                                @if (Relative)
                                {
                                    <b>@Victim.Name</b>
                                }
                                else
                                {
                                    @((MarkupString)Victim.GetLabelForPicture())
                                }
                            </small>
                        </div>
                        @if (!string.IsNullOrEmpty(Victim.RelationshipToPersonCs))
                        {
                            <div><small>@(CultureInfo.CurrentCulture.ToString() == "cs-CZ" ? Victim.RelationshipToPersonCs : Victim.RelationshipToPersonEn)</small></div>
                        }
                    </div>
                </RadzenStack>
            </RadzenCard>

        }

    </RadzenColumn>
}

@code {
    [Parameter]
    public VictimShortInfoModel? Victim { get; set; }

    [Parameter]
    public bool Small { get; set; } = false;

    [Parameter]
    public bool Relative { get; set; } = false;

    private string? VictimCardCss;

    protected override void OnInitialized()
    {
        VictimCardCss = (Small ? "victim-card-small" : "victim-card") + " rz-mb-4";
    }

    public async Task OnVictimClick()
    {
        if (Victim == null || (!Victim?.LongInfo ?? false))
            return;

        await MapState.ShowVictimInfo(Victim?.Id);
    }
}
