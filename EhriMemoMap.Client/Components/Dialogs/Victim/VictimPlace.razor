@inject IStringLocalizer<CommonResources> cl
@inject MapStateService MapState
@inject StoryMapService StoryMapService
@inject IJSRuntime JSRuntime


@if (Places != null && Places.Count() > 0)
{
    var place = Places[0];
    if (Places.Count() == 1)
    {
        <tr>
            <td>
                @nameType
            </td>
            <td>
                @if (ShowDates)
                {
                    @place.GetAddressWithDates(CultureInfo.CurrentCulture.Name)
                }
                else
                {
                    @place.GetAddress(CultureInfo.CurrentCulture.Name)
                }
            </td>
        </tr>
    }
    else if (Places.Count() > 1)
    {
        <tr>
            <td>
                @((CultureInfo.CurrentCulture.Name == "en-US" ? place.TypeEn : place.TypeCs)?.FirstLetterToUpper())
            </td>
            <td>
                @Places.OrderBy(a => a.Id).Select(a => a.GetAddressWithDates(CultureInfo.CurrentCulture.Name)).Aggregate((a, b) => a + ", " + b)
            </td>
        </tr>

    }
}


@code {
    [Parameter]
    public long Type { get; set; }

    [Parameter]
    public string? ResourceNameType { get; set; }

    [Parameter]
    public bool ShowDates { get; set; } = true; 

    private string? nameType;

    private AddressInfo[]? Places { get; set; }

    protected override void OnInitialized()
    {
        Places = MapState.VictimLongInfo?.Places?.Where(a => a.Type == Type).ToArray();
        if (Places == null || Places.Count() == 0)
            return;

        nameType = !string.IsNullOrEmpty(ResourceNameType)
            ? cl[ResourceNameType]
            : (CultureInfo.CurrentCulture.Name == "en-US" ? Places?[0]?.TypeEn : Places?[0]?.TypeCs)?.FirstLetterToUpper();
    }

}
